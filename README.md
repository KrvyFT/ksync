# WebDAV 同步工具

一个功能强大的 Flutter WebDAV 同步工具，专为 Android 平台设计，提供可靠的文件同步功能。

## 功能特性

### 🔄 核心同步功能
- **智能增量同步**：仅同步发生变化的文件，节省带宽和时间
- **混合变更检测**：结合时间戳和内容哈希，确保同步准确性
- **冲突解决**：自动处理文件冲突，保护用户数据
- **多目录支持**：支持同时同步多个本地目录

### ⚙️ 灵活的配置选项
- **多种同步频率**：从每15分钟到每天，或手动同步
- **智能约束条件**：仅在 Wi-Fi、充电、设备空闲时同步
- **排除规则**：支持文件模式排除，如 `*.tmp`、`cache/`
- **安全存储**：使用 Android Keystore 安全存储凭证

### 📱 现代化用户界面
- **Material 3 设计**：采用最新的 Material Design 3 设计语言
- **实时进度显示**：同步过程中显示详细进度信息
- **状态可视化**：清晰显示同步状态和配置信息
- **历史记录**：完整的同步历史记录和统计信息

### 🔋 电池友好
- **后台任务优化**：使用 WorkManager 实现可靠的后台同步
- **电源管理兼容**：遵循 Android Doze 和 App Standby 机制
- **可配置约束**：用户可自定义同步条件，平衡功能与电池续航

## 技术架构

### 分层架构设计
```
┌─────────────────────────────────────┐
│            Presentation Layer       │
│  (UI, BLoC, Pages, Widgets)        │
├─────────────────────────────────────┤
│            Domain Layer             │
│  (Entities, Use Cases, Repositories)│
├─────────────────────────────────────┤
│            Data Layer               │
│  (Repositories, Data Sources)       │
└─────────────────────────────────────┘
```

### 核心技术栈
- **状态管理**：BLoC (Business Logic Component)
- **依赖注入**：get_it + injectable
- **本地数据库**：Hive (高性能 NoSQL)
- **安全存储**：flutter_secure_storage
- **后台任务**：workmanager
- **WebDAV 客户端**：webdav_client
- **文件选择**：file_picker

## 安装与运行

### 环境要求
- Flutter 3.10.0 或更高版本
- Dart 3.0.0 或更高版本
- Android SDK API 21 或更高版本

### 安装步骤

1. **克隆项目**
   ```bash
   git clone <repository-url>
   cd webdav_sync_tool
   ```

2. **安装依赖**
   ```bash
   flutter pub get
   ```

3. **生成代码**
   ```bash
   flutter packages pub run build_runner build
   ```

4. **运行应用**
   ```bash
   flutter run
   ```

### 构建发布版本
```bash
flutter build apk --release
```

## 使用指南

### 首次配置

1. **配置 WebDAV 服务器**
   - 打开应用，点击设置
   - 输入 WebDAV 服务器地址、用户名和密码
   - 点击"测试连接"验证配置

2. **选择同步目录**
   - 在设置页面点击"添加"选择本地目录
   - 支持选择多个目录同时同步

3. **设置同步选项**
   - 选择同步频率（每15分钟到每天，或手动）
   - 配置约束条件（Wi-Fi、充电、空闲等）
   - 设置排除规则（可选）

### 开始同步

- **手动同步**：点击主界面的同步按钮
- **自动同步**：配置完成后，应用将按设定频率自动同步
- **查看进度**：同步过程中可实时查看进度和状态
- **查看历史**：在同步历史页面查看所有同步记录

## 配置说明

### WebDAV 服务器配置
- **服务器地址**：完整的 WebDAV 服务器 URL
- **用户名**：WebDAV 账户用户名
- **密码**：WebDAV 账户密码（安全存储在 Android Keystore 中）

### 同步选项
- **同步频率**：
  - 每 15 分钟
  - 每 30 分钟
  - 每小时
  - 每 2 小时
  - 每 6 小时
  - 每天
  - 手动

- **约束条件**：
  - 仅在 Wi-Fi 下同步
  - 仅在充电时同步
  - 仅在设备空闲时同步
  - 仅在电量充足时同步

### 排除规则
支持通配符模式，例如：
- `*.tmp`：排除所有临时文件
- `cache/`：排除缓存目录
- `*.log`：排除日志文件

## 开发指南

### 项目结构
```
lib/
├── core/                    # 核心功能
│   ├── di/                 # 依赖注入
│   ├── background/         # 后台任务
│   ├── models/            # 核心模型
│   └── utils/             # 工具类
├── data/                   # 数据层
│   ├── datasources/       # 数据源
│   ├── models/            # 数据模型
│   └── repositories/      # 仓库实现
├── domain/                 # 领域层
│   ├── entities/          # 实体
│   ├── repositories/      # 仓库接口
│   └── usecases/          # 用例
└── presentation/           # 表示层
    ├── blocs/             # BLoC
    ├── pages/             # 页面
    └── widgets/           # 组件
```

### 添加新功能

1. **领域层**：定义实体和用例
2. **数据层**：实现数据访问逻辑
3. **表示层**：创建 UI 组件和状态管理

### 测试
```bash
# 运行单元测试
flutter test

# 运行集成测试
flutter test integration_test/
```

## 故障排除

### 常见问题

**Q: 同步失败，提示连接错误**
A: 检查 WebDAV 服务器地址、用户名和密码是否正确，确保网络连接正常。

**Q: 应用无法在后台同步**
A: 检查是否授予了必要的权限，并确保设备没有过度限制后台应用。

**Q: 文件同步不完整**
A: 检查排除规则设置，确保目标文件没有被排除。

### 日志查看
应用会在同步历史中记录详细的错误信息，可通过设置页面查看。

## 贡献指南

欢迎提交 Issue 和 Pull Request！

### 开发环境设置
1. Fork 项目
2. 创建功能分支
3. 提交更改
4. 创建 Pull Request

### 代码规范
- 遵循 Dart 官方代码规范
- 使用 BLoC 进行状态管理
- 编写单元测试
- 添加适当的注释

## 许可证

本项目采用 MIT 许可证 - 详见 [LICENSE](LICENSE) 文件。

## 更新日志

### v1.0.0
- 初始版本发布
- 支持基本的 WebDAV 同步功能
- Material 3 用户界面
- 后台自动同步
- 同步历史记录

## 联系方式

如有问题或建议，请通过以下方式联系：
- 提交 Issue
- 发送邮件
- 参与讨论

---

**注意**：本应用需要访问存储权限以进行文件同步，请确保授予必要权限以确保正常功能。
